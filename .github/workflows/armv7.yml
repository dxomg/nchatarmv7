name: Build ARMv7 Binary

on:
  push:   # runs on any push
    branches: 
      - '*'  # all branches

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Build inside ARM container
        uses: pguyot/arm-runner-action@v2
        id: build_image
        with:
          base_image: raspios_lite:latest
          commands: |
            set -e
            apt update
            apt install -y \
              ccache cmake build-essential gperf help2man \
              libreadline-dev libssl-dev libncurses-dev ncurses-doc \
              zlib1g-dev libsqlite3-dev libmagic-dev golang

            mkdir -p build
            cd build
            cmake ..
            make -s -j$(nproc)

            # Output binary path for artifact upload
            echo "::set-output name=binary::$(pwd)/mybinary"  # replace 'mybinary' with your binary name

      - name: Upload binary artifact
        uses: actions/upload-artifact@v4
        with:
          name: mybinary
          path: ${{ steps.build_image.outputs.binary }}
